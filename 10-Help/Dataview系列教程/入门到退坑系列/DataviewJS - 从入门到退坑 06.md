---
source: "https://publish.obsidian.md/napkinium/Ideas/Dataview/Learnings/Dataview+Learnings"
---
````dialogue
left: 😯
right: 🤣
titleMode: all
< 答叔。  
> 哎。  
< 我上次，不是说想要在表格里加一些比较复杂的筛选规则吗。  
> 是有这么回事儿。  
< 我自己后来试了一下。  
> 嗯。  
< 你猜怎么着？  
> 怎么着？  
< 花了我一下午的功夫——  
> 真努力了。  
< 最后总算是——  
> 搞定了？  
< 不好使 o(￣▽￣)ｄ  
> 嗐！谁搁这儿跟你演相声呐！

< 不过确实是不好使。  
> 怎么个不好使法？  
< 我把我写的码给你看看。

```
dv.table(
  ["File", "Score", "Author", "Status"],
  dv.pages('"Test"').filter(p => (Date.now() - p.file.cday) < 10).sort(p => p.status, 'desc').sort(p => p.score, 'desc')
  .map(p => [p.file.link, p.score, p.author, p.status])
)
```

> 这个……你是想要筛掉创建在十天或者以前的文件。  
< 对吧，你能看明白吧？那为什么跑不起来呢？哦也不是跑不起来，而是根本什么都没剩下。  
> 能看明白和实现得没问题还是有一定区别的。你觉得问题出在哪里？  
< 因为别的地方都没问题，那就是我加的那部分出问题了，至于具体为什么……不知道。  
> 嘛，毕竟JS就是这个样子的，而且作为非计算机行业人员，让你一上来就自己调试这个也是挺难的了。建议你有时间看一下[[DataviewJS - 从入门到退坑 番外 01]]。  
< 好，码了回头看。  
> 至于这段代码的问题，我想最直观的解释方式就是，你把这一段代码实际跑一下，看看输出什么。

```
dv.paragraph(Date.now() - dv.current().file.cday);
```

< 为啥是个八位数啊！？？？  
> 所以说，JS在很多地方都会悄悄地帮倒忙。  
< 帮倒忙？  
> 这里的根本问题是，你所用的`Date.now()`和DVJS里面的时间，比如`file.ctime`，是不同的对象类型。  
< 唔……那为什么明明是不同的对象类型，却能一起运算啊？  
> JS在遇到两个不同的类型的时候，会根据你所提供的运算符和先后顺序，强行进行一些换算，然后再进行计算。举个🌰，你猜`3 + "4"`在JS里面会输出什么？  
< ……7？这是一个数字和一个字符串吧？  
> `"34"`。  
< 呃……  
> 但是如果你问`3 - "4"`的话，答案倒确实是`-1`。  
< ……………………  
> 原因的话，就是因为加号在有字符串的语境下，可以理解成“前后相连”的意思。JS看到字符串和加号后，就擅自决定把前面的3也作为字符串来理解了。  
< ……………………  
> 但是在减号的情况下，因为字符串相减并没有（明显的）意义，所以JS就考虑到前面的数字和减号，决定把`"4"`理解为数字，于是就得出了`-1`这个结果。  
< 委托方！？我特烦？！挖头发！？！？  
> 所以，今天的一个小知识：如果你不是JS大佬，那么对于各种中间变量，记得确认其内容和类型是否符合你的预期。  
< ……那这次会把日期变成数字是怎么变的？  
> [从1970年1月1日UTC开始的毫秒数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/now)。  
< 然后`file.cday`……  
> 可以说幸运，也可以说不幸的，虽然是不同的类型，但是在转换成整数的前提下，也是同样的规矩，不过因为是`cday`而不是`ctime`，所以会取整到最近的一整天。所以你的那个减法，不是“从创建到现在的天数”，而是“从创建到现在的毫秒数”，全都不小于10也很正常。  
< 唔。诶，那是不是我除以一天中的毫秒数就可以了？  
> 是的。  
< 唔，一天24小时，一小时60分钟……我去拿下计算器。  
> 86,400,000毫秒。  
< 你是码农，不公平。那我试试。

```
dv.table(
  ["File", "Score", "Author", "Status"],
  dv.pages('"Test"').filter(p => ((Date.now() - p.file.cday) / 86400000) < 10).sort(p => p.status, 'desc').sort(p => p.score, 'desc')
  .map(p => [p.file.link, p.score, p.author, p.status])
)
```

< 啊，好像可以了！  
> 理论上，你不需要那么多括号也不会造成歧义，但是我觉得，在和JS打交道的时候，哪怕是给自己多一份安心，多写那么几个括号确保意义表达无误，也总好过花两个小时检查。  
< 好！  
> 以及我上期其实是有现成的日期比较用的代码来着，你没看到吗？  
< !?(･\_･;?

````